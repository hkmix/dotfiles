#+TITLE: How to set xkb options to remap keyboards

1. Add a partial modifier mapping to [[file:/usr/share/X11/xkb/symbols/us]]:

   #+BEGIN_SRC text
   // Custom mapping type
   partial modifier_keys
   xkb_symbols "hhkb" {include "us(basic)"
       key <BKSP> { [ backslash, bar ] };
       key <BKSL> { [ BackSpace, BackSpace ] };

       replace key <LWIN> { [ Control_L, Control_L ] };
       replace key <LCTL> { [ Alt_L, Meta_L ] };
       replace key <LALT> { [ Super_L ] };

       modifier_map Mod1    { <LCTL> };
       modifier_map Mod4    { <LALT> };
       modifier_map Control { <LWIN> };
   };
   #+END_SRC

2. Add a variant to [[file:/usr/share/X11/xkb/rules/base.xml]]:

   #+BEGIN_SRC xml
     <variant>
       <configItem>
         <name>hhkb</name>
         <description>English (HHKB-like, for Chromebooks)</description>
       </configItem>
     </variant>
   #+END_SRC

3. Add the same variant to [[file:/usr/share/X11/xkb/rules/base.lst]]:

   #+BEGIN_SRC text
     hhkb            us: English (HHKB-like, for Chromebooks)
   #+END_SRC

4. Add a Xorg configuration file to load it, e.g. [[file:/usr/share/X11/xorg.conf.d/41-keyboard-tweaks.conf]]:

   #+BEGIN_SRC conf
     Section "InputClass"
         Identifier "Built-in keyboard"
         MatchProduct "AT Translated Set 2 keyboard"

         Option "XkbLayout" "us"
         Option "XkbVariant" "hhkb"
     EndSection
   #+END_SRC

   Note that the correct item is based on the output of =xinput=.

5. Restart X, good to go.
